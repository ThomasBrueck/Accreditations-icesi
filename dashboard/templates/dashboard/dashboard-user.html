{% extends 'dashboard/base-dashboard.html' %}
{% load static %}

{% block title %}Dashboard User{% endblock %}

{% block css_files %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.35.3/dist/apexcharts.css">
<link rel='stylesheet' href="{% static 'dashboard/dashboard.css' %}">
<link rel='stylesheet' href="{% static 'dashboard/sidebar.css' %}">
<link rel='stylesheet' href="{% static 'dashboard/dashboard-presentation.css' %}">
<link rel='stylesheet' href="{% static 'dashboard/timeline.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}

{% block js_files %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.35.3/dist/apexcharts.min.js"></script>
<script src="{% static 'dashboard/js/graph-dashboard.js' %}"></script>
<script src="{% static 'dashboard/js/timeline.js' %}"></script>
{% endblock %}

{% block content %}
{% csrf_token %}
{% include "dashboard/include/sidebar.html" %}

<div class="main-content">
  {% include "dashboard/include/navbar.html" %}
  
  <div class="dashboard-container">
    <div class="dashboard-title">
      <h1>User Dashboard</h1>
      <p class="subtitle">Welcome to the user panel</p>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon reports">
          <i class="bi bi-file-earmark-text"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ total_reports }}</h3>
          <p class="stat-label">Total Reports</p>
        </div>
      </div>
    </div>

    <div class="dashboard-grid">
      <div class="dashboard-card">
        <div class="card-header">
          <h2>Reports Status</h2>
        </div>
        <div class="card-body chart-container">
          <div id="statusChart" 
               data-active="{{ active_count }}"
               data-inactive="{{ inactive_count }}"
               class="chart"></div>
        </div>
      </div>

      <div class="dashboard-card">
        <div class="card-header">
          <h2>Latest Comments</h2>
        </div>
        <div class="card-body">
          <ul class="comment-list">
            {% for comment in recent_comments %}
              <li class="comment-item">
                <div class="comment-header">
                  <h4>{{ comment.title }}</h4>
                  <span class="comment-author">{{ comment.owner.username }}</span>
                </div>
                <div class="comment-time">{{ comment.created_at|timesince }} ago</div>
              </li>
            {% empty %}
              <li class="empty-list">No recent comments</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="dashboard-card full-width">
      <div class="card-header with-action">
        <h2>Recent Reports</h2>
        <a href="{% url 'report-list' %}" class="btn-primary">View All</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="data-table">
            <thead>
              <tr>
                <th>Report Name</th>
                <th>Created By</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for report in recent_reports %}
                <tr>
                  <td class="report-name">{{ report.name }}</td>
                  <td>{{ report.created_by.username }}</td>
                  <td>{{ report.created_at|timesince }} ago</td>
                  <td>
                    <span class="status-badge {% if report.status == 'active' %}active{% else %}inactive{% endif %}">
                      {{ report.status }}
                    </span>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="4" class="empty-table">No recent reports</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>

    <div class="dashboard-card full-width timeline-card">
        <div class="card-header">
            <h2>Accreditation Process Timeline</h2>
        </div>
        <div class="card-body p-0"> 
            <div class="timeline" id="process-timeline">
                <div class="timeline-progress" data-progress="2"></div> 
                <div class="timeline-item">
                    <div class="timeline-dot" id="dot1"><i class="fas fa-check"></i></div>
                    <div class="timeline-text">
                        <span class="stage">Etapa 01 - Notificación inicial</span>
                        <span class="status completed">Completed</span>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot" id="dot2"><i class="fas fa-tasks"></i></div>
                    <div class="timeline-text">
                        <span class="stage">Etapa 02 - Preparación</span>
                        <span class="status completed">Completed</span>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot" id="dot3"><i class="fas fa-chart-line"></i></div>
                    <div class="timeline-text">
                        <span class="stage">Etapa 03 - Análisis de resultados</span>
                        <span class="status in-progress">In Progress</span>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot" id="dot4"><i class="fas fa-camera"></i></div>
                    <div class="timeline-text">
                        <span class="stage">Etapa 04 - Evaluación de factores</span>
                        <span class="status pending">Pending</span>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot" id="dot5"><i class="fas fa-file-alt"></i></div>
                    <div class="timeline-text">
                        <span class="stage">Etapa 05 - Consolidación de informe</span>
                        <span class="status pending">Pending</span>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot" id="dot6"><i class="fas fa-paperclip"></i></div>
                    <div class="timeline-text">
                        <span class="stage">Etapa 06 - Radicación documentos</span>
                        <span class="status pending">Pending</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const accreditationStatusUrl = "{% url 'get_accreditation_status' %}";
        const csrfToken = '{{ csrf_token }}';
    </script>
  </div>
</div>
{% endblock %}